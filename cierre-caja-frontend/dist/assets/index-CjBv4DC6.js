const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dashboard-BCBd8i24.js","assets/react-vendor-emGiN04W.js","assets/dateUtils-DNdQ6mri.js","assets/icons-ByAfuB2N.js","assets/MonthlySales-C2Bc-Uqb.js"])))=>i.map(i=>d[i]);
import{a as e,b as r,g as t,r as n,N as s,R as o,u as a,B as i,c as l,d as c}from"./react-vendor-emGiN04W.js";import{A as d,R as u,L as m}from"./icons-ByAfuB2N.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&r(e)}).observe(document,{childList:!0,subtree:!0})}function r(e){if(e.ep)return;e.ep=!0;const r=function(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?r.credentials="include":"anonymous"===e.crossOrigin?r.credentials="omit":r.credentials="same-origin",r}(e);fetch(e.href,r)}}();var h,p,f={exports:{}},x={};var b,g=(p||(p=1,f.exports=function(){if(h)return x;h=1;var r=e(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function i(e,r,n){var i,l={},c=null,d=null;for(i in void 0!==n&&(c=""+n),void 0!==r.key&&(c=""+r.key),void 0!==r.ref&&(d=r.ref),r)s.call(r,i)&&!a.hasOwnProperty(i)&&(l[i]=r[i]);if(e&&e.defaultProps)for(i in r=e.defaultProps)void 0===l[i]&&(l[i]=r[i]);return{$$typeof:t,type:e,key:c,ref:d,props:l,_owner:o.current}}return x.Fragment=n,x.jsx=i,x.jsxs=i,x}()),f.exports),y={};const j=t(function(){if(b)return y;b=1;var e=r();return y.createRoot=e.createRoot,y.hydrateRoot=e.hydrateRoot,y}()),w={},v=function(e,r,t){let n=Promise.resolve();if(r&&r.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),s=t?.nonce||t?.getAttribute("nonce");n=e(r.map(e=>{if((e=function(e){return"/"+e}(e))in w)return;w[e]=!0;const r=e.endsWith(".css"),t=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${t}`))return;const n=document.createElement("link");return n.rel=r?"stylesheet":"modulepreload",r||(n.as="script"),n.crossOrigin="",n.href=e,s&&n.setAttribute("nonce",s),document.head.appendChild(n),r?new Promise((r,t)=>{n.addEventListener("load",r),n.addEventListener("error",()=>t(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=e,window.dispatchEvent(r),!r.defaultPrevented)throw e}return n.then(r=>{for(const e of r||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})},N=(e,r)=>{try{const t="string"==typeof r?r:JSON.stringify(r),n=btoa(unescape(encodeURIComponent(t)));sessionStorage.setItem(e,n)}catch(t){}},E=e=>{try{const r=sessionStorage.getItem(e);if(!r)return null;const t=decodeURIComponent(escape(atob(r)));try{return JSON.parse(t)}catch{return t}}catch(r){return null}},S=e=>{try{sessionStorage.removeItem(e)}catch(r){}};const k=new class{log(...e){}warn(...e){}error(...e){}info(...e){}debug(...e){}group(e){}groupEnd(){}table(e){}time(e){}timeEnd(e){}},_=["http://10.28.168.57:5000","http://localhost:5000"],C="https://cierre-caja-api.onrender.com";let O=null;const P=async(e,r,t)=>{const n=new AbortController,s=setTimeout(()=>n.abort(),t);try{const t=await fetch(e,{...r,signal:n.signal});return clearTimeout(s),t}catch(o){throw clearTimeout(s),o}},T=async(e,r={},t=null)=>{const n=E("authToken"),s={"Content-Type":"application/json",...r.headers||{}};n&&(s.Authorization=`Bearer ${n}`);const o={...r,headers:s};let a=null;const i=(()=>{const e=window.location.hostname;return!["onrender.com","netlify.app","vercel.app","github.io","herokuapp.com","railway.app","fly.dev"].some(r=>e.endsWith(r)||e.includes(r))&&("localhost"===e||"127.0.0.1"===e||e.startsWith("192.168.")||e.startsWith("10.")||e.startsWith("172.16.")||e.startsWith("172.17.")||e.startsWith("172.18.")||e.startsWith("172.19.")||e.startsWith("172.2")||e.startsWith("172.30.")||e.startsWith("172.31."))})();if(i?k.info("Frontend en entorno LOCAL - Prioridad: backends locales"):k.info("Frontend en entorno DESPLEGADO - Usando solo backend desplegado"),O)if(i||O===C)try{const r=_.includes(O),n=t||(r?15e3:8e4);if(a=await P(`${O}${e}`,o,n),a.ok||401===a.status){if(401===a.status)throw S("authToken"),S("authUser"),window.location.href="/login",new Error("Sesión expirada. Por favor inicia sesión nuevamente.");return a}}catch(l){k.warn(`Error al conectar con ${O}:`,l.message),O=null}else O=null;if(i){for(const r of _)try{k.info("Intentando conectar con backend local:",r);const n=t||15e3;if(a=await P(`${r}${e}`,o,n),O=r,k.info("Conectado exitosamente con backend local:",r),401===a.status)throw S("authToken"),S("authUser"),window.location.href="/login",new Error("Sesión expirada. Por favor inicia sesión nuevamente.");return a}catch(c){k.warn(`Backend local ${r} no disponible`)}k.warn("Backends locales no disponibles, intentando con backend desplegado como fallback...")}try{k.info("Conectando con backend desplegado:",C);const r=t||3e4;if(a=await P(`${C}${e}`,o,r),O=C,k.info("Conectado exitosamente con backend desplegado"),401===a.status)throw S("authToken"),S("authUser"),window.location.href="/login",new Error("Sesión expirada. Por favor inicia sesión nuevamente.");return a}catch(d){const e=i?{locales:_.join(", "),deployed:C,lastError:d.message}:{deployed:C,lastError:d.message};throw k.error("Error de conexión:",e),new Error("No se pudo conectar con el servidor. Por favor verifica tu conexión a internet.")}},I=async e=>{const r=await T("/api/sum_payments",{method:"POST",body:JSON.stringify(e)});if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error(e.message||"Error al procesar el cierre de caja")}return await r.json()},R=n.createContext(null),D=({children:e})=>{const[r,t]=n.useState(null),[s,o]=n.useState(null),[a,i]=n.useState(!0),[l,c]=n.useState(0),[d,u]=n.useState(null);n.useEffect(()=>{const e=E("authToken"),r=E("authUser");if(e&&r)try{const n="string"==typeof r?JSON.parse(r):r;if(n.loginTime){const r=new Date(n.loginTime).getTime();Date.now()-r>288e5?(k.warn("Sesión expirada"),m()):(o(e),t(n))}}catch(n){k.error("Error al restaurar sesión:",n),m()}i(!1)},[]);const m=()=>{S("authToken"),S("authUser"),o(null),t(null)},h={user:r,token:s,login:async(e,r)=>{if(d&&(Date.now()<d||(u(null),c(0),0))){return{success:!1,error:`Cuenta bloqueada. Intenta nuevamente en ${Math.ceil((d-Date.now())/1e3/60)} minutos.`}}if(!e||!r)return{success:!1,error:"Email y contraseña son requeridos"};if(!(e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))(e))return{success:!1,error:"Formato de email inválido"};if(r.length<8)return{success:!1,error:"La contraseña debe tener al menos 8 caracteres"};try{const n=await T("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:r})}),s=await n.json();if(!n.ok){const e=l+1;if(c(e),e>=5){const e=Date.now()+9e5;return u(e),k.warn("Cuenta bloqueada después de 5 intentos fallidos"),{success:!1,error:"Demasiados intentos fallidos. Cuenta bloqueada por 15 minutos."}}return k.warn(`Intento de login fallido (${e}/5)`),{success:!1,error:s.message||`Credenciales incorrectas (${e}/5 intentos)`}}c(0),u(null);const a=s.token,i={email:s.user.email,name:s.user.name,role:s.user.role,loginTime:(new Date).toISOString()};return N("authToken",a),N("authUser",i),o(a),t(i),k.info("Login exitoso para:",e),{success:!0}}catch(n){return k.error("Error en login:",n.message),{success:!1,error:"Error al conectar con el servidor. Por favor intente nuevamente."}}},logout:m,isAuthenticated:()=>!!s&&!!r,loading:a};return g.jsx(R.Provider,{value:h,children:e})},A=()=>{const e=n.useContext(R);if(!e)throw new Error("useAuth debe ser usado dentro de un AuthProvider");return e},L=({children:e})=>{const{isAuthenticated:r,loading:t}=A();return t?g.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:g.jsxs("div",{className:"text-center",children:[g.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),g.jsx("p",{className:"text-gray-600 font-medium",children:"Verificando sesión..."})]})}):r()?e:g.jsx(s,{to:"/login",replace:!0})};var $,U,W,q,F,B={exports:{}};function J(){if(U)return $;U=1;return $="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}function M(){if(q)return W;q=1;var e=J();function r(){}function t(){}return t.resetWarningCache=r,W=function(){function n(r,t,n,s,o,a){if(a!==e){var i=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw i.name="Invariant Violation",i}}function s(){return n}n.isRequired=n;var o={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:s,element:n,elementType:n,instanceOf:s,node:n,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:t,resetWarningCache:r};return o.PropTypes=o,o}}function V(){return F||(F=1,B.exports=M()()),B.exports}const z=t(V());class G extends o.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,r){k.error("Error capturado por Error Boundary:",e,r),this.setState({error:e,errorInfo:r})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:g.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:g.jsx("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-xl p-8",children:g.jsxs("div",{className:"flex flex-col items-center text-center",children:[g.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:g.jsx(d,{className:"w-10 h-10 text-red-600"})}),g.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"¡Ups! Algo salió mal"}),g.jsx("p",{className:"text-gray-600 mb-6",children:"Lo sentimos, ha ocurrido un error inesperado. Por favor, intenta nuevamente."}),!1,g.jsxs("button",{onClick:this.handleReset,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-semibold hover:from-blue-700 hover:to-purple-700 transition-all shadow-lg",children:[g.jsx(u,{className:"w-5 h-5"}),"Reintentar"]}),g.jsxs("p",{className:"mt-4 text-sm text-gray-500",children:["Si el problema persiste,"," ",g.jsx("a",{href:"mailto:soporte@koaj.com",className:"text-blue-600 hover:underline",children:"contacta a soporte"})]})]})})}):this.props.children}}G.propTypes={children:z.node.isRequired,fallback:z.node};const K=()=>{const[e,r]=n.useState(""),[t,s]=n.useState(""),[o,i]=n.useState(""),[l,c]=n.useState(!1),{login:u}=A(),h=a();return g.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:g.jsx("div",{className:"max-w-md w-full",children:g.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[g.jsxs("div",{className:"text-center mb-8",children:[g.jsx("div",{className:"inline-flex items-center justify-center mb-3",children:g.jsx("div",{className:"bg-gray-900 rounded-2xl p-3 shadow-lg",children:g.jsx("div",{className:"text-white text-xl font-bold tracking-widest",style:{fontFamily:"Arial, sans-serif",letterSpacing:"0.3em"},children:"KOAJ"})})}),g.jsx("div",{className:"mb-3",children:g.jsx("p",{className:"text-lg font-semibold text-blue-600",children:"Puerto Carreño"})}),g.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Sistema de Cierre de Caja y Arqueo Diario"}),g.jsx("p",{className:"text-gray-600",children:"Inicia sesión para acceder al sistema"})]}),o&&g.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[g.jsx(d,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),g.jsx("p",{className:"text-sm text-red-800",children:o})]}),g.jsxs("form",{onSubmit:async r=>{r.preventDefault(),i(""),c(!0);try{const r=await u(e,t);r.success?h("/"):i(r.error||"Error al iniciar sesión")}catch(n){i("Error al iniciar sesión. Por favor intenta de nuevo.")}finally{c(!1)}},className:"space-y-6",children:[g.jsxs("div",{children:[g.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Correo electrónico"}),g.jsx("input",{id:"email",type:"email",value:e,onChange:e=>r(e.target.value),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all outline-none",placeholder:"usuario@ejemplo.com",disabled:l})]}),g.jsxs("div",{children:[g.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Contraseña"}),g.jsx("input",{id:"password",type:"password",value:t,onChange:e=>s(e.target.value),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all outline-none",placeholder:"••••••••",disabled:l})]}),g.jsx("button",{type:"submit",disabled:l,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:l?g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Iniciando sesión..."]}):g.jsxs(g.Fragment,{children:[g.jsx(m,{className:"w-5 h-5"}),"Iniciar sesión"]})})]}),g.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:g.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Sistema de Gestión de Cierre de Caja v5.0"})})]})})})},Y=n.lazy(()=>v(()=>import("./Dashboard-BCBd8i24.js").then(e=>e.D),__vite__mapDeps([0,1,2,3]))),H=n.lazy(()=>v(()=>import("./MonthlySales-C2Bc-Uqb.js"),__vite__mapDeps([4,1,2,3]))),Q=()=>g.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:g.jsxs("div",{className:"text-center",children:[g.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),g.jsx("p",{className:"mt-4 text-gray-600 font-medium",children:"Cargando..."})]})}),X=()=>g.jsx(G,{children:g.jsx(D,{children:g.jsx(i,{children:g.jsx(n.Suspense,{fallback:g.jsx(Q,{}),children:g.jsxs(l,{children:[g.jsx(c,{path:"/login",element:g.jsx(K,{})}),g.jsx(c,{path:"/dashboard",element:g.jsx(L,{children:g.jsx(Y,{})})}),g.jsx(c,{path:"/monthly-sales",element:g.jsx(L,{children:g.jsx(H,{})})}),g.jsx(c,{path:"/",element:g.jsx(s,{to:"/dashboard",replace:!0})}),g.jsx(c,{path:"*",element:g.jsx(s,{to:"/dashboard",replace:!0})})]})})})})});j.createRoot(document.getElementById("root")).render(g.jsx(o.StrictMode,{children:g.jsx(X,{})}));export{v as _,T as a,g as j,k as l,I as s,A as u};
