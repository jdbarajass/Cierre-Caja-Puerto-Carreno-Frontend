import{l as e,u as s,j as t}from"./index-DWbouc5W.js";import{r as a}from"./react-vendor-CzBFtDtE.js";import{a as r,C as l,b as n,T as o,P as i,X as d,F as c,c as m,d as x,A as p,D as g}from"./icons-Bni8isUj.js";const b="http://localhost:5000",u="https://cierre-caja-api.onrender.com";let h=null;const j=async(e,s,t)=>{const a=new AbortController,r=setTimeout(()=>a.abort(),t);try{const t=await fetch(e,{...s,signal:a.signal});return clearTimeout(r),t}catch(l){throw clearTimeout(r),l}},f=async s=>{const t=await(async(s,t={})=>{const a=localStorage.getItem("authToken"),r={"Content-Type":"application/json",...t.headers||{}};a&&(r.Authorization=`Bearer ${a}`);const l={...t,headers:r};let n=null,o=null;if(h)try{if(n=await j(`${h}${s}`,l,h===b?5e3:8e4),n.ok||401===n.status){if(401===n.status)throw localStorage.removeItem("authToken"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Sesi√≥n expirada. Por favor inicia sesi√≥n nuevamente.");return n}}catch(i){e.warn(`Error al conectar con ${h}:`,i.message),o=i,h=null}try{if(e.info("Intentando conectar con backend local:",b),n=await j(`${b}${s}`,l,5e3),h=b,e.info("Conectado exitosamente con backend local"),401===n.status)throw localStorage.removeItem("authToken"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Sesi√≥n expirada. Por favor inicia sesi√≥n nuevamente.");return n}catch(d){e.warn("Backend local no disponible, intentando con backend desplegado..."),o=d;try{if(e.info("Intentando conectar con backend desplegado:",u),n=await j(`${u}${s}`,l,3e4),h=u,e.info("Conectado exitosamente con backend desplegado"),401===n.status)throw localStorage.removeItem("authToken"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Sesi√≥n expirada. Por favor inicia sesi√≥n nuevamente.");return n}catch(c){throw e.error("Ambos backends fallaron:",{local:o.message,deployed:c.message}),new Error("No se pudo conectar con ning√∫n servidor. Por favor verifica tu conexi√≥n a internet.")}}})("/sum_payments",{method:"POST",body:JSON.stringify(s)});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.message||"Error al procesar el cierre de caja")}return await t.json()},v=()=>{var e,b;const{user:u,logout:h}=s(),[j,v]=a.useState((new Date).toISOString().split("T")[0]),[N,y]=a.useState(!1),[_,w]=a.useState(null),[I,C]=a.useState(null),[S,T]=a.useState(!1),[q,k]=a.useState({50:"",100:"",200:"",500:"",1e3:""}),[E,B]=a.useState({2e3:"",5e3:"",1e4:"",2e4:"",5e4:"",1e5:""}),[O,D]=a.useState([{id:1,tipo:"efectivo",subtipo:"",valor:""}]),[M,A]=a.useState({gastos_operativos:"",gastos_operativos_nota:"",prestamos:"",prestamos_nota:""}),[F,P]=a.useState({addi_datafono:"",nequi_luz_helena:"",daviplata_jose:"",qr_julieth:"",tarjeta_debito:"",tarjeta_credito:""}),$=[{value:"efectivo",label:"Excedente Efectivo"},{value:"qr_transferencias",label:"Excedente QR/Transferencias"},{value:"datafono",label:"Excedente Datafono"}],z=[{value:"nequi",label:"Nequi"},{value:"daviplata",label:"Daviplata"},{value:"qr",label:"QR"}],R=e=>e.replace(/[^0-9]/g,""),L=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e),Q=e=>Object.entries(e).reduce((e,[s,t])=>e+parseInt(s)*parseInt(t||0),0),U=Q(q),G=Q(E),J=U+G,V=O.reduce((e,s)=>e+(parseInt(s.valor)||0),0),K=parseInt(F.nequi_luz_helena||0)+parseInt(F.daviplata_jose||0)+parseInt(F.qr_julieth||0),H=parseInt(F.addi_datafono||0)+parseInt(F.tarjeta_debito||0)+parseInt(F.tarjeta_credito||0);return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 py-4 sm:py-8 px-3 sm:px-4",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsx("div",{className:"flex justify-end mb-4",children:t.jsxs("div",{className:"flex items-center gap-3 bg-white rounded-xl shadow-md px-4 py-2 border border-gray-100",children:[t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Usuario: "}),t.jsx("span",{className:"font-semibold text-gray-900",children:null==u?void 0:u.email})]}),t.jsxs("button",{onClick:()=>{h()},className:"flex items-center gap-2 px-3 py-1.5 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-all text-sm font-medium",children:[t.jsx(r,{className:"w-4 h-4"}),"Cerrar Sesi√≥n"]})]})}),t.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[t.jsx("div",{className:"inline-flex items-center justify-center mb-3 sm:mb-4",children:t.jsx("div",{className:"bg-gray-900 rounded-3xl p-6 sm:p-8 shadow-2xl",children:t.jsx("div",{className:"text-white text-4xl sm:text-5xl font-bold tracking-widest",style:{fontFamily:"Arial, sans-serif",letterSpacing:"0.3em"},children:"KOAJ"})})}),t.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-1 px-2",children:"Cierre Diario de Caja"}),t.jsx("p",{className:"text-lg sm:text-xl text-blue-600 font-semibold mb-1",children:"Puerto Carre√±o"}),t.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:"Sistema de arqueo y conciliaci√≥n"})]}),t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-6 border border-gray-100",children:[t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-3 sm:mb-4",children:[t.jsx(l,{className:"w-4 h-4 sm:w-5 sm:h-5 text-blue-600"}),t.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Fecha del Cierre"})]}),t.jsx("input",{type:"date",value:j,onChange:e=>v(e.target.value),className:"w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm sm:text-base",required:!0})]}),t.jsxs("div",{className:"grid lg:grid-cols-2 gap-4 sm:gap-6",children:[t.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-6 border border-gray-100",children:[t.jsxs("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 mb-3 sm:mb-4 flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500"}),"Monedas"]}),t.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[Object.keys(q).map(e=>t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[t.jsxs("label",{className:"w-16 sm:w-24 text-xs sm:text-sm font-medium text-gray-700",children:["$",parseInt(e).toLocaleString()]}),t.jsx("input",{type:"text",inputMode:"numeric",value:q[e],onChange:s=>k({...q,[e]:R(s.target.value)}),onFocus:e=>e.target.select(),className:"flex-1 px-3 sm:px-4 py-1.5 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-sm sm:text-base",placeholder:"0"}),t.jsx("span",{className:"w-20 sm:w-28 text-right text-xs sm:text-sm font-semibold text-gray-900",children:L(parseInt(e)*(parseInt(q[e])||0))})]},e)),t.jsx("div",{className:"pt-2 sm:pt-3 border-t border-gray-200",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Total Monedas:"}),t.jsx("span",{className:"text-base sm:text-lg font-bold text-yellow-600",children:L(U)})]})})]})]}),t.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-6 border border-gray-100",children:[t.jsxs("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 mb-3 sm:mb-4 flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),"Billetes"]}),t.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[Object.keys(E).map(e=>t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[t.jsxs("label",{className:"w-16 sm:w-24 text-xs sm:text-sm font-medium text-gray-700",children:["$",parseInt(e).toLocaleString()]}),t.jsx("input",{type:"text",inputMode:"numeric",value:E[e],onChange:s=>B({...E,[e]:R(s.target.value)}),onFocus:e=>e.target.select(),className:"flex-1 px-3 sm:px-4 py-1.5 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm sm:text-base",placeholder:"0"}),t.jsx("span",{className:"w-20 sm:w-28 text-right text-xs sm:text-sm font-semibold text-gray-900",children:L(parseInt(e)*(parseInt(E[e])||0))})]},e)),t.jsx("div",{className:"pt-2 sm:pt-3 border-t border-gray-200",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Total Billetes:"}),t.jsx("span",{className:"text-base sm:text-lg font-bold text-green-600",children:L(G)})]})})]})]})]}),t.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-6 border border-gray-100",children:[t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-3 sm:mb-4",children:[t.jsx(n,{className:"w-4 h-4 sm:w-5 sm:h-5 text-indigo-600"}),t.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Registro de M√©todos de Pago"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-purple-50 rounded-xl p-4 border border-purple-100",children:[t.jsx("h3",{className:"text-sm font-semibold text-purple-900 mb-3",children:"Transferencias (QR)"}),t.jsxs("div",{className:"grid sm:grid-cols-3 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nequi"}),t.jsx("input",{type:"text",inputMode:"numeric",value:F.nequi_luz_helena,onChange:e=>P({...F,nequi_luz_helena:R(e.target.value)}),onFocus:e=>e.target.select(),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",placeholder:"0"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Daviplata"}),t.jsx("input",{type:"text",inputMode:"numeric",value:F.daviplata_jose,onChange:e=>P({...F,daviplata_jose:R(e.target.value)}),onFocus:e=>e.target.select(),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",placeholder:"0"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Transferencias (QR)"}),t.jsx("input",{type:"text",inputMode:"numeric",value:F.qr_julieth,onChange:e=>P({...F,qr_julieth:R(e.target.value)}),onFocus:e=>e.target.select(),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",placeholder:"0"})]})]}),K>0&&t.jsxs("div",{className:"mt-2 text-sm font-semibold text-purple-700",children:["Total: ",L(K)]})]}),t.jsxs("div",{className:"bg-orange-50 rounded-xl p-4 border border-orange-100",children:[t.jsx("h3",{className:"text-sm font-semibold text-orange-900 mb-3",children:"Datafono"}),t.jsxs("div",{className:"grid sm:grid-cols-3 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Addi (Datafono)"}),t.jsx("input",{type:"text",inputMode:"numeric",value:F.addi_datafono,onChange:e=>P({...F,addi_datafono:R(e.target.value)}),onFocus:e=>e.target.select(),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm",placeholder:"0"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tarjeta D√©bito (Datafono)"}),t.jsx("input",{type:"text",inputMode:"numeric",value:F.tarjeta_debito,onChange:e=>P({...F,tarjeta_debito:R(e.target.value)}),onFocus:e=>e.target.select(),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm",placeholder:"0"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tarjeta Cr√©dito (Datafono)"}),t.jsx("input",{type:"text",inputMode:"numeric",value:F.tarjeta_credito,onChange:e=>P({...F,tarjeta_credito:R(e.target.value)}),onFocus:e=>e.target.select(),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm",placeholder:"0"})]})]}),H>0&&t.jsxs("div",{className:"mt-2 text-sm font-semibold text-orange-700",children:["Total: ",L(H)]})]})]})]}),t.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-6 border border-gray-100",children:[t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-3 sm:mb-4",children:[t.jsx(o,{className:"w-4 h-4 sm:w-5 sm:h-5 text-purple-600"}),t.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Ajustes y Movimientos"})]}),t.jsxs("div",{className:"mb-4 sm:mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("label",{className:"block text-sm sm:text-base font-medium text-gray-700",children:"Excedentes (Opcional)"}),O.length<3&&t.jsxs("button",{type:"button",onClick:()=>{O.length<3&&D([...O,{id:Date.now(),tipo:"efectivo",subtipo:"",valor:""}])},className:"flex items-center gap-1 px-2 sm:px-3 py-1 sm:py-1.5 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all text-xs sm:text-sm",children:[t.jsx(i,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"Agregar"]})]}),t.jsx("div",{className:"space-y-3",children:O.map(e=>t.jsx("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200 space-y-2",children:t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[t.jsx("div",{className:"flex-1",children:t.jsx("select",{value:e.tipo,onChange:s=>{return t=e.id,a=s.target.value,void D(O.map(e=>e.id===t?{...e,tipo:a,subtipo:"qr_transferencias"===a?"nequi":""}:e));var t,a},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",children:$.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})}),"qr_transferencias"===e.tipo&&t.jsx("div",{className:"flex-1",children:t.jsx("select",{value:e.subtipo,onChange:s=>{return t=e.id,a=s.target.value,void D(O.map(e=>e.id===t?{...e,subtipo:a}:e));var t,a},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",children:z.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",inputMode:"numeric",value:e.valor,onChange:s=>((e,s)=>{const t=R(s);D(O.map(s=>s.id===e?{...s,valor:t}:s))})(e.id,s.target.value),onFocus:e=>e.target.select(),className:"flex-1 sm:w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",placeholder:"0"}),O.length>1&&t.jsx("button",{type:"button",onClick:()=>{return s=e.id,void(O.length>1&&D(O.filter(e=>e.id!==s)));var s},className:"p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-all",children:t.jsx(d,{className:"w-4 h-4"})})]})]})},e.id))}),V>0&&t.jsx("div",{className:"mt-3 p-2 bg-purple-50 rounded-lg",children:t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsx("span",{className:"font-medium text-gray-700",children:"Total Excedentes:"}),t.jsx("span",{className:"font-bold text-purple-600",children:L(V)})]})})]}),t.jsxs("div",{className:"grid sm:grid-cols-2 gap-3 sm:gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gastos Operativos"}),t.jsx("input",{type:"text",inputMode:"numeric",value:M.gastos_operativos,onChange:e=>A({...M,gastos_operativos:R(e.target.value)}),onFocus:e=>e.target.select(),className:"w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm sm:text-base mb-2",placeholder:"0"}),t.jsxs("div",{className:"relative",children:[t.jsx(c,{className:"absolute left-3 top-2.5 w-4 h-4 text-gray-400"}),t.jsx("input",{type:"text",value:M.gastos_operativos_nota,onChange:e=>A({...M,gastos_operativos_nota:e.target.value}),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",placeholder:"Nota: ej. Compra de papeler√≠a..."})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pr√©stamos"}),t.jsx("input",{type:"text",inputMode:"numeric",value:M.prestamos,onChange:e=>A({...M,prestamos:R(e.target.value)}),onFocus:e=>e.target.select(),className:"w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm sm:text-base mb-2",placeholder:"0"}),t.jsxs("div",{className:"relative",children:[t.jsx(c,{className:"absolute left-3 top-2.5 w-4 h-4 text-gray-400"}),t.jsx("input",{type:"text",value:M.prestamos_nota,onChange:e=>A({...M,prestamos_nota:e.target.value}),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",placeholder:"Nota: ej. Pr√©stamo a Mar√≠a..."})]})]})]})]}),t.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-6 text-white",children:t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-2",children:[t.jsx("span",{className:"text-lg sm:text-xl font-semibold",children:"Total en Caja:"}),t.jsx("span",{className:"text-2xl sm:text-3xl font-bold",children:L(J)})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[t.jsx("button",{onClick:async()=>{var e,s;y(!0),C(null),T(!1);try{const t={excedente_efectivo:0,excedente_datafono:0,excedente_nequi:0,excedente_daviplata:0,excedente_qr:0},a=[];O.forEach(e=>{const s=parseInt(e.valor)||0;s>0&&("efectivo"===e.tipo?(t.excedente_efectivo+=s,a.push({tipo:"Efectivo",valor:s})):"datafono"===e.tipo?(t.excedente_datafono+=s,a.push({tipo:"Datafono",valor:s})):"qr_transferencias"===e.tipo&&("nequi"===e.subtipo?(t.excedente_nequi+=s,a.push({tipo:"Transferencia",subtipo:"Nequi",valor:s})):"daviplata"===e.subtipo?(t.excedente_daviplata+=s,a.push({tipo:"Transferencia",subtipo:"Daviplata",valor:s})):"qr"===e.subtipo&&(t.excedente_qr+=s,a.push({tipo:"Transferencia",subtipo:"QR",valor:s}))))});const r={date:j,coins:Object.fromEntries(Object.entries(q).map(([e,s])=>[e,parseInt(s)||0])),bills:Object.fromEntries(Object.entries(E).map(([e,s])=>[e,parseInt(s)||0])),excedente:V,...t,excedentes_detalle:a,gastos_operativos:parseInt(M.gastos_operativos)||0,gastos_operativos_nota:M.gastos_operativos_nota||"",prestamos:parseInt(M.prestamos)||0,prestamos_nota:M.prestamos_nota||"",metodos_pago:{addi_datafono:parseInt(F.addi_datafono)||0,nequi_luz_helena:parseInt(F.nequi_luz_helena)||0,daviplata_jose:parseInt(F.daviplata_jose)||0,qr_julieth:parseInt(F.qr_julieth)||0,tarjeta_debito:parseInt(F.tarjeta_debito)||0,tarjeta_credito:parseInt(F.tarjeta_credito)||0,total_transferencias_registradas:K,total_datafono_registrado:H}},l=await f(r);l.excedentes_detalle=a,l.gastos_operativos_nota=M.gastos_operativos_nota,l.prestamos_nota=M.prestamos_nota,l.metodos_pago_registrados=r.metodos_pago;const n=((e,s)=>{const t=45e4,a=Object.entries(e).reduce((e,[s,t])=>e+parseInt(s)*parseInt(t||0),0),r=Object.entries(s).reduce((e,[s,t])=>e+parseInt(s)*parseInt(t||0),0),l=a+r;if(l<=t)return{cajaBase:{coins:{...e},bills:{...s},totalCoins:a,totalBills:r,total:l},consignacion:{coins:{50:0,100:0,200:0,500:0,1e3:0},bills:{2e3:0,5e3:0,1e4:0,2e4:0,5e4:0,1e5:0},totalCoins:0,totalBills:0,total:0}};let n=l;const o={},i={},d={},c={};Object.keys(e).forEach(e=>{o[e]=0,d[e]=0}),Object.keys(s).forEach(e=>{i[e]=0,c[e]=0});const m=["100000","50000","20000","10000","5000","2000"];for(const u of m){const e=parseInt(s[u]||0),a=parseInt(u);if(e>0){let s=0;for(;s<e&&n-a>=t;)s++,n-=a;c[u]=s,i[u]=e-s}}Object.entries(e).forEach(([e,s])=>{o[e]=parseInt(s||0)});const x=Object.entries(o).reduce((e,[s,t])=>e+parseInt(s)*t,0),p=Object.entries(i).reduce((e,[s,t])=>e+parseInt(s)*t,0),g=Object.entries(d).reduce((e,[s,t])=>e+parseInt(s)*t,0),b=Object.entries(c).reduce((e,[s,t])=>e+parseInt(s)*t,0);return{cajaBase:{coins:o,bills:i,totalCoins:x,totalBills:p,total:x+p},consignacion:{coins:d,bills:c,totalCoins:g,totalBills:b,total:b+g}}})(q,E);l.distribucion_caja=n,w(l);const o=l.alegra.results.transfer.total||0,i=((null==(e=l.alegra.results["debit-card"])?void 0:e.total)||0)+((null==(s=l.alegra.results["credit-card"])?void 0:s.total)||0),d=Math.abs(o-K),c=Math.abs(i-H);d<100&&c<100&&T(!0)}catch(t){C(t.message||"Error desconocido")}finally{y(!1)}},disabled:N,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 sm:py-4 rounded-xl font-semibold hover:from-blue-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 text-sm sm:text-base",children:N?t.jsxs(t.Fragment,{children:[t.jsx(m,{className:"w-4 h-4 sm:w-5 sm:h-5 animate-spin"}),"Procesando..."]}):t.jsxs(t.Fragment,{children:[t.jsx(x,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Realizar Cierre"]})}),t.jsx("button",{onClick:()=>{k({50:"",100:"",200:"",500:"",1e3:""}),B({2e3:"",5e3:"",1e4:"",2e4:"",5e4:"",1e5:""}),D([{id:1,tipo:"efectivo",subtipo:"",valor:""}]),A({gastos_operativos:"",gastos_operativos_nota:"",prestamos:"",prestamos_nota:""}),P({addi_datafono:"",nequi_luz_helena:"",daviplata_jose:"",qr_julieth:"",tarjeta_debito:"",tarjeta_credito:""}),w(null),C(null),T(!1)},className:"sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 transition-all text-sm sm:text-base",children:"Limpiar"})]})]}),S&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsx("div",{className:"bg-white rounded-2xl p-6 sm:p-8 max-w-md w-full shadow-2xl animate-bounce-once",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4",children:t.jsx(x,{className:"w-10 h-10 text-green-600"})}),t.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"¬°Cierre Exitoso!"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"Los montos registrados coinciden con los datos de Alegra. El cierre se ha realizado correctamente."}),t.jsx("button",{onClick:()=>T(!1),className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 rounded-xl font-semibold hover:from-green-600 hover:to-emerald-700 transition-all",children:"Continuar"})]})})}),I&&t.jsxs("div",{className:"mt-4 sm:mt-6 bg-red-50 border border-red-200 rounded-xl p-3 sm:p-4 flex items-start gap-2 sm:gap-3",children:[t.jsx(p,{className:"w-4 h-4 sm:w-5 sm:h-5 text-red-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm sm:text-base font-semibold text-red-900",children:"Error"}),t.jsx("p",{className:"text-xs sm:text-sm text-red-700",children:I})]})]}),_&&t.jsx("div",{className:"mt-6 sm:mt-8 space-y-4 sm:space-y-6",children:t.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-6 border border-gray-100",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 mb-4 sm:mb-6",children:"Resultados del Cierre"}),t.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 mb-6 border border-blue-100",children:[t.jsx("h3",{className:"text-base font-semibold text-blue-900 mb-3",children:"Comparaci√≥n de M√©todos de Pago"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"bg-white rounded-lg p-3",children:[t.jsx("div",{className:"flex justify-between items-center mb-2",children:t.jsx("span",{className:"font-semibold text-sm",children:"Transferencias"})}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-600",children:"Alegra:"}),t.jsx("div",{className:"font-semibold text-purple-700",children:_.alegra.results.transfer.formatted})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-600",children:"Registrado:"}),t.jsx("div",{className:"font-semibold text-blue-700",children:L(_.metodos_pago_registrados.total_transferencias_registradas)})]})]}),t.jsxs("div",{className:"mt-2 text-xs",children:[t.jsx("div",{className:"text-gray-600",children:"Desglose:"}),t.jsxs("div",{className:"grid grid-cols-3 gap-1 mt-1",children:[t.jsxs("div",{children:["Nequi: ",L(_.metodos_pago_registrados.nequi_luz_helena)]}),t.jsxs("div",{children:["Daviplata: ",L(_.metodos_pago_registrados.daviplata_jose)]}),t.jsxs("div",{children:["QR: ",L(_.metodos_pago_registrados.qr_julieth)]})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg p-3",children:[t.jsx("div",{className:"flex justify-between items-center mb-2",children:t.jsx("span",{className:"font-semibold text-sm",children:"Datafono"})}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-600",children:"Alegra (D√©b + Cr√©d):"}),t.jsx("div",{className:"font-semibold text-orange-700",children:L(((null==(e=_.alegra.results["debit-card"])?void 0:e.total)||0)+((null==(b=_.alegra.results["credit-card"])?void 0:b.total)||0))})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-600",children:"Registrado:"}),t.jsx("div",{className:"font-semibold text-blue-700",children:L(_.metodos_pago_registrados.total_datafono_registrado)})]})]}),t.jsxs("div",{className:"mt-2 text-xs",children:[t.jsx("div",{className:"text-gray-600",children:"Desglose:"}),t.jsxs("div",{className:"grid grid-cols-3 gap-1 mt-1",children:[t.jsxs("div",{children:["Addi: ",L(_.metodos_pago_registrados.addi_datafono)]}),t.jsxs("div",{children:["T. D√©bito: ",L(_.metodos_pago_registrados.tarjeta_debito)]}),t.jsxs("div",{children:["T. Cr√©dito: ",L(_.metodos_pago_registrados.tarjeta_credito)]})]})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6",children:[t.jsxs("div",{className:"bg-blue-50 rounded-xl p-3 sm:p-4 border border-blue-100",children:[t.jsx("div",{className:"text-xs sm:text-sm text-blue-600 font-medium mb-1",children:"Efectivo"}),t.jsx("div",{className:"text-lg sm:text-2xl font-bold text-blue-900",children:_.alegra.results.cash.formatted})]}),t.jsxs("div",{className:"bg-purple-50 rounded-xl p-3 sm:p-4 border border-purple-100",children:[t.jsx("div",{className:"text-xs sm:text-sm text-purple-600 font-medium mb-1",children:"Transferencia"}),t.jsx("div",{className:"text-lg sm:text-2xl font-bold text-purple-900",children:_.alegra.results.transfer.formatted})]}),t.jsxs("div",{className:"bg-green-50 rounded-xl p-3 sm:p-4 border border-green-100",children:[t.jsx("div",{className:"text-xs sm:text-sm text-green-600 font-medium mb-1",children:"Tarjeta D√©bito"}),t.jsx("div",{className:"text-lg sm:text-2xl font-bold text-green-900",children:_.alegra.results["debit-card"].formatted})]}),t.jsxs("div",{className:"bg-orange-50 rounded-xl p-3 sm:p-4 border border-orange-100",children:[t.jsx("div",{className:"text-xs sm:text-sm text-orange-600 font-medium mb-1",children:"Tarjeta Cr√©dito"}),t.jsx("div",{className:"text-lg sm:text-2xl font-bold text-orange-900",children:_.alegra.results["credit-card"].formatted})]})]}),t.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl p-4 sm:p-6 text-white mb-4 sm:mb-6",children:[t.jsx("div",{className:"text-xs sm:text-sm font-medium opacity-90 mb-1",children:"TOTAL VENTA DEL D√çA"}),t.jsx("div",{className:"text-2xl sm:text-4xl font-bold",children:_.alegra.total_sale.formatted})]}),t.jsxs("div",{className:"grid sm:grid-cols-2 gap-4 sm:gap-6 mb-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 sm:p-4",children:[t.jsx("h3",{className:"text-sm sm:text-base font-semibold text-gray-900 mb-2 sm:mb-3",children:"Base de Caja"}),t.jsxs("div",{className:"space-y-1.5 sm:space-y-2 text-xs sm:text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Total Base:"}),t.jsx("span",{className:"font-semibold",children:_.cash_count.base.total_base_formatted})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Base Exacta:"}),t.jsx("span",{className:"font-semibold "+(_.cash_count.base.exact_base_obtained?"text-green-600":"text-red-600"),children:_.cash_count.base.exact_base_obtained?"S√≠":"No"})]})]})]}),t.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 sm:p-4",children:[t.jsx("h3",{className:"text-sm sm:text-base font-semibold text-gray-900 mb-2 sm:mb-3",children:"A Consignar"}),t.jsxs("div",{className:"space-y-1.5 sm:space-y-2 text-xs sm:text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Efectivo Final:"}),t.jsx("span",{className:"font-semibold text-green-600",children:_.cash_count.consignar.efectivo_para_consignar_final_formatted})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Sin Ajustes:"}),t.jsx("span",{className:"font-semibold",children:_.cash_count.consignar.total_consignar_sin_ajustes_formatted})]})]})]})]}),_.distribucion_caja&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[t.jsx(g,{className:"w-6 h-6 text-blue-600"}),"Distribuci√≥n de Monedas y Billetes"]}),t.jsxs("div",{className:"grid lg:grid-cols-2 gap-4 sm:gap-6",children:[t.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 sm:p-6 border-2 border-blue-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-bold text-blue-900",children:"üí∞ Caja Base (450,000)"}),t.jsx("div",{className:"text-right",children:t.jsx("div",{className:"text-2xl font-bold text-blue-900",children:L(_.distribucion_caja.cajaBase.total)})})]}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("h4",{className:"text-sm font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[t.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-500"}),"Monedas"]}),t.jsxs("div",{className:"bg-white rounded-lg p-3 space-y-1.5",children:[Object.entries(_.distribucion_caja.cajaBase.coins).map(([e,s])=>{const a=parseInt(s||0),r=a*parseInt(e);return 0===a?null:t.jsxs("div",{className:"flex items-center text-xs",children:[t.jsxs("span",{className:"text-gray-600 w-20",children:["$",parseInt(e).toLocaleString(),":"]}),t.jsxs("span",{className:"text-gray-900 font-semibold w-16 text-right",children:[a," un."]}),t.jsx("span",{className:"flex-1 mx-2 border-b border-dotted border-gray-300"}),t.jsx("span",{className:"font-semibold text-gray-900 bg-yellow-50 px-2 py-0.5 rounded",children:L(r)})]},e)}),t.jsxs("div",{className:"pt-2 border-t border-gray-200 flex justify-between items-center",children:[t.jsx("span",{className:"text-xs font-semibold text-gray-700",children:"Subtotal Monedas:"}),t.jsx("span",{className:"text-sm font-bold text-yellow-600",children:L(_.distribucion_caja.cajaBase.totalCoins)})]})]})]}),t.jsxs("div",{children:[t.jsxs("h4",{className:"text-sm font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[t.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),"Billetes"]}),t.jsxs("div",{className:"bg-white rounded-lg p-3 space-y-1.5",children:[Object.entries(_.distribucion_caja.cajaBase.bills).map(([e,s])=>{const a=parseInt(s||0),r=a*parseInt(e);return 0===a?null:t.jsxs("div",{className:"flex items-center text-xs",children:[t.jsxs("span",{className:"text-gray-600 w-20",children:["$",parseInt(e).toLocaleString(),":"]}),t.jsxs("span",{className:"text-gray-900 font-semibold w-16 text-right",children:[a," un."]}),t.jsx("span",{className:"flex-1 mx-2 border-b border-dotted border-gray-300"}),t.jsx("span",{className:"font-semibold text-gray-900 bg-green-50 px-2 py-0.5 rounded",children:L(r)})]},e)}),t.jsxs("div",{className:"pt-2 border-t border-gray-200 flex justify-between items-center",children:[t.jsx("span",{className:"text-xs font-semibold text-gray-700",children:"Subtotal Billetes:"}),t.jsx("span",{className:"text-sm font-bold text-green-600",children:L(_.distribucion_caja.cajaBase.totalBills)})]})]})]})]}),t.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl p-4 sm:p-6 border-2 border-emerald-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-bold text-emerald-900",children:"üè¶ Para Consignaci√≥n"}),t.jsx("div",{className:"text-right",children:t.jsx("div",{className:"text-2xl font-bold text-emerald-900",children:L(_.distribucion_caja.consignacion.total)})})]}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("h4",{className:"text-sm font-semibold text-emerald-800 mb-2 flex items-center gap-2",children:[t.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-500"}),"Monedas"]}),t.jsxs("div",{className:"bg-white rounded-lg p-3 space-y-1.5",children:[Object.entries(_.distribucion_caja.consignacion.coins).map(([e,s])=>{const a=parseInt(s||0),r=a*parseInt(e);return 0===a?null:t.jsxs("div",{className:"flex items-center text-xs",children:[t.jsxs("span",{className:"text-gray-600 w-20",children:["$",parseInt(e).toLocaleString(),":"]}),t.jsxs("span",{className:"text-gray-900 font-semibold w-16 text-right",children:[a," un."]}),t.jsx("span",{className:"flex-1 mx-2 border-b border-dotted border-gray-300"}),t.jsx("span",{className:"font-semibold text-gray-900 bg-yellow-50 px-2 py-0.5 rounded",children:L(r)})]},e)}),0===_.distribucion_caja.consignacion.totalCoins?t.jsx("div",{className:"text-xs text-gray-500 italic text-center py-2",children:"No hay monedas para consignar"}):t.jsxs("div",{className:"pt-2 border-t border-gray-200 flex justify-between items-center",children:[t.jsx("span",{className:"text-xs font-semibold text-gray-700",children:"Subtotal Monedas:"}),t.jsx("span",{className:"text-sm font-bold text-yellow-600",children:L(_.distribucion_caja.consignacion.totalCoins)})]})]})]}),t.jsxs("div",{children:[t.jsxs("h4",{className:"text-sm font-semibold text-emerald-800 mb-2 flex items-center gap-2",children:[t.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),"Billetes"]}),t.jsxs("div",{className:"bg-white rounded-lg p-3 space-y-1.5",children:[Object.entries(_.distribucion_caja.consignacion.bills).map(([e,s])=>{const a=parseInt(s||0),r=a*parseInt(e);return 0===a?null:t.jsxs("div",{className:"flex items-center text-xs",children:[t.jsxs("span",{className:"text-gray-600 w-20",children:["$",parseInt(e).toLocaleString(),":"]}),t.jsxs("span",{className:"text-gray-900 font-semibold w-16 text-right",children:[a," un."]}),t.jsx("span",{className:"flex-1 mx-2 border-b border-dotted border-gray-300"}),t.jsx("span",{className:"font-semibold text-gray-900 bg-green-50 px-2 py-0.5 rounded",children:L(r)})]},e)}),0===_.distribucion_caja.consignacion.totalBills?t.jsx("div",{className:"text-xs text-gray-500 italic text-center py-2",children:"No hay billetes para consignar"}):t.jsxs("div",{className:"pt-2 border-t border-gray-200 flex justify-between items-center",children:[t.jsx("span",{className:"text-xs font-semibold text-gray-700",children:"Subtotal Billetes:"}),t.jsx("span",{className:"text-sm font-bold text-green-600",children:L(_.distribucion_caja.consignacion.totalBills)})]})]})]})]})]}),t.jsx("div",{className:"mt-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl p-4 text-white",children:t.jsxs("div",{className:"grid sm:grid-cols-3 gap-4 text-center",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-medium opacity-90 mb-1",children:"Total en Caja Base"}),t.jsx("div",{className:"text-xl font-bold",children:L(_.distribucion_caja.cajaBase.total)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-medium opacity-90 mb-1",children:"Total para Consignar"}),t.jsx("div",{className:"text-xl font-bold",children:L(_.distribucion_caja.consignacion.total)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-medium opacity-90 mb-1",children:"Total Contado"}),t.jsx("div",{className:"text-xl font-bold",children:L(_.distribucion_caja.cajaBase.total+_.distribucion_caja.consignacion.total)})]})]})})]}),t.jsxs("div",{className:"bg-yellow-50 rounded-xl p-3 sm:p-4 border border-yellow-100",children:[t.jsx("h3",{className:"text-sm sm:text-base font-semibold text-gray-900 mb-2 sm:mb-3",children:"Ajustes Aplicados"}),_.excedentes_detalle&&_.excedentes_detalle.length>0&&t.jsxs("div",{className:"mb-4",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-700 mb-2",children:"Excedentes:"}),t.jsx("div",{className:"space-y-2",children:_.excedentes_detalle.map((e,s)=>t.jsxs("div",{className:"flex items-center text-xs bg-white rounded-lg px-3 py-2 border border-gray-200",children:[t.jsxs("span",{className:"text-gray-600 whitespace-nowrap",children:[e.tipo," ",e.subtipo&&`(${e.subtipo})`,":"]}),t.jsx("span",{className:"flex-1 mx-2 border-b-2 border-dotted border-gray-300 min-w-[20px]"}),t.jsx("span",{className:"font-semibold text-gray-900 whitespace-nowrap bg-yellow-50 px-2 py-1 rounded",children:L(e.valor)})]},s))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4 text-xs sm:text-sm",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-600 mb-1",children:"Total Excedente"}),t.jsx("div",{className:"font-semibold",children:_.cash_count.adjustments.excedente_formatted})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-600 mb-1",children:"Gastos Operativos"}),t.jsx("div",{className:"font-semibold",children:_.cash_count.adjustments.gastos_operativos_formatted}),_.gastos_operativos_nota&&t.jsxs("div",{className:"text-xs text-gray-500 mt-1 italic",children:["Nota: ",_.gastos_operativos_nota]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-600 mb-1",children:"Pr√©stamos"}),t.jsx("div",{className:"font-semibold",children:_.cash_count.adjustments.prestamos_formatted}),_.prestamos_nota&&t.jsxs("div",{className:"text-xs text-gray-500 mt-1 italic",children:["Nota: ",_.prestamos_nota]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-600 mb-1",children:"Venta Efectivo Alegra"}),t.jsx("div",{className:"font-semibold",children:_.cash_count.adjustments.venta_efectivo_diaria_alegra_formatted})]})]})]}),t.jsx("div",{className:"mt-4 sm:mt-6 pt-3 sm:pt-4 border-t border-gray-200 text-xs sm:text-sm text-gray-600",children:t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-2",children:[t.jsxs("span",{children:["Usuario: ",_.username_used]}),t.jsxs("span",{children:["Fecha: ",_.request_date," ",_.request_time]})]})})]})})]})})};export{v as default};
